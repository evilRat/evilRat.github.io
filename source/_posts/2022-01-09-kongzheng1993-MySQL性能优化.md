---
title: MySQL性能优化
excerpt: 'mysql'
tags: [mysql]
categories: [mysql]
comments: true
date: 2022-01-09 18:30:52
---

# MySQL性能优化

## 硬件和操作系统层面的优化

硬件层面影响MySQL运行的因素主要有：CPU、可用内存大小、磁盘读写速度、网络带宽

操作系统层面影响因素主要有：应用文件句柄数、操作系统的网络配置

这部分的优化一般是由运维工程师去完成。在硬件基础资源的优化中，我们重点应该关注的层面是服务本身所承载的体量，然后提出合理的指标要求，避免出现资源浪费的现象。

## 架构设计层面的优化

MySQL是一个磁盘IO访问非常频繁的关系型数据库，在高并发和高性能的场景中，mysql会承受巨大的并发压力，优化的思路如下：

1. 搭建MySQL主从集群，避免单点故障。
2. 读写分离设计，可以避免读写冲突导致的性能问题；引入分库分表机制，通过分库，降低单个服务器节点的IO压力，通过分表可以降低单表数据量，从而提升SQL查询效率。
3. 对于热点数据，可以引入Redis、MongoDB等分布式数据库，可以很好的缓解MySQL的压力，同时还能提升数据的检索性能。

## MySQL程序配置优化

对于MySQL程序本身的优化，一般可以通过MySQL配置文件（my.cnf）来进行。比如说MySQL5.7版本默认的最大连接数是151个，binlog日志默认不开启，Bufferpool缓存池默认大小等都可以通过my.cnf来配置。配置的重点在于：作用域分为会话级别和全局范围、是否支持热加载。全局参数的设定对于已经存在的会话是无法生效的，会话参数的设定随着会话的销毁而失效，全局的统一配置建议配置在默认配置文件中，否则重启服务会导致配置失效。

## SQL执行优化

SQL优化可以分为三个步骤：

1. 慢SQL的定位和排查。通过慢查询日志和慢查询日志分析工具得到有问题的SQL列表。
2. 执行计划分析。针对慢SQL使用explain来查看当前SQL的执行计划，可以重点关注type、key、rows、filtered等字段从去定位该SQL执行慢的根本原因，再去有的放矢的进行优化。
3. 使用show profile（MySQL提供的用于查看SQL语句执行中查看SQL语句资源消耗情况的工具）。默认情况下show profile是关闭的。打开之后会保存最近15次的运行结果。针对运行慢的SQL通过此工具进行详细分析可以得到SQL执行过程中所有资源的开销情况，比如IO、CPU、内存等。

## 常见SQL优化的规则

1. SQL的查询一定要基于索引来进行数据扫描
2. 避免索引列上使用函数或者运算符
3. where子句中like %进行放置在右侧，最左原则
4. 使用索引扫描，联合索引中的列从左往右，命中越多越好
5. 尽可能使用SQL语句中用到的索引完成排序
6. 查询有效的列信息即可，少用*代替
7. 永远用小的结果集驱动大结果集