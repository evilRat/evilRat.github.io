---
title: MQ
date: 2019-06-04 14:36:47
tags: [mq, 消息队列]
---

最近去面试了，想去一个技术氛围好的团队。。。一直都认为自己菜，环境占大部分问题，是因为队友菜，我才会菜，即使我努力也是菜。面试官很好，很和蔼，让我对自己有了更清晰的认识，我会最近应该不会再面试了，我要沉淀一下，总结一下。

## MQ使用场景

调用方实时依赖执行结果的业务场景，要使用调用，而不是mq。

1. task代替cron排班表，不再硬编码执行时间，而是通过在前一个任务执行完发布消息，下一个任务订阅这个消息来完成整个流程。
2. 上游不关心执行结果。用mq解耦。上游服务不用等待下游服务处理完再返回。即使下游服务宕机，用户也不会感知到，一旦下游服务恢复正常可以继续消费之前的消息。
3. 上游关心执行结果，但是执行时间长。这种情况经常使用回调网管+mq来完成。
    比如下面的过程：
    - 调用方直接跨公网调用微信接口
    - 微信返回调用成功，此时并不代表返回成功
    - 微信执行完成后，回调统一网关
    - 网关将返回结果通知MQ
    - 请求方收到结果通知


## MQ的作用
1. 解耦：减小各系统间的耦合度，防止牵一发而动全身。
2. 异步：提高系统响应时间，本来同步接口需要等下游系统处理完成再返回，现在可以直接返回，下游系统通过消费消息来完成自己的业务。
3. 削峰/限流：在大量请求来临的时候，系统可能无法即使处理，严重的情况可能会导致系统崩溃。使用mq，可以将请求写到mq，下游系统根据自己的能力去消费消息。